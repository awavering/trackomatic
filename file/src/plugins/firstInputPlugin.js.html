<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/plugins/firstInputPlugin.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/vigetlabs/trackomatic.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/plugin.js~Plugin.html">Plugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/trackomatic.js~Trackomatic.html">Trackomatic</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-once">once</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-providePlugin">providePlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-config">config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-plugin">plugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-trackomatic">trackomatic</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-util">util</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">plugins</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/plugins/errorReportingPlugin.js~ErrorReportingPlugin.html">ErrorReportingPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/plugins/firstInputPlugin.js~FirstInputPlugin.html">FirstInputPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/plugins/linkTrackingPlugin.js~LinkTrackingPlugin.html">LinkTrackingPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/plugins/viewportTrackingPlugin.js~ViewportTrackingPlugin.html">ViewportTrackingPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-errorReportingPlugin">errorReportingPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-firstInputPlugin">firstInputPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-linkTrackingPlugin">linkTrackingPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-viewportTrackingPlugin">viewportTrackingPlugin</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/plugins/firstInputPlugin.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const BasePlugin = require(&apos;../plugin&apos;)
const once       = require(&apos;../once&apos;)

/**
 * Tracks what the first interaction mode is (mouse, touch, keyboard)
 *
 * @class FirstInputPlugin
 * @extends plugin as BasePlugin
 */
class FirstInputPlugin extends BasePlugin {

  /**
   * The setup function for this plugin
   *
   * @function install
   * @returns { Void }
   */
  install() {
    this.firstInputRecorded = false

    once(window, this.getMouseEvent(), this.onMouseInput.bind(this))
    once(window, &apos;touchstart&apos;,         this.onTouchInput.bind(this))
    once(window, &apos;keydown&apos;,            this.onKeyboardInput.bind(this))
  }

  /**
   * Returns the proper name of the mouse event for this environment
   *
   * @function getMouseEvent
   * @returns { String } - the name of the mouse event for this browser
   **/
  getMouseEvent() {
    let event = &apos;mousedown&apos;

    if (window.PointerEvent) {
      event = &apos;pointerdown&apos;
    } else if (window.MSPointerEvent) {
      event = &apos;MSPointerDown&apos;
    }

    return event
  }

  /**
   * Callback for mouse input events
   *
   * @function onMouseInput
   * @param { Object } e - the event object
   * @returns { Void }
   **/
  onMouseInput(e) {
    this.recordFirstInput(&apos;mouse&apos;, this.__trackomatic__.util.keyCode(e))
  }

  /**
   * Callback for touch input events
   *
   * @function onTouchInput
   * @param { Object } e - the event object
   * @returns { Void }
   **/
  onTouchInput(e) {
    this.recordFirstInput(&apos;touch&apos;, this.__trackomatic__.util.keyCode(e))
  }

  /**
   * Callback for keyboard input events
   *
   * @function onKeyboardInput
   * @param { Object } e - the event object
   * @returns { Void }
   **/
  onKeyboardInput(e) {
    e = e || window.event
    let code      = this.__trackomatic__.util.keyCode(e)
    let blacklist = this.__trackomatic__.config.EXCLUDED_KEYS

    /**
     * Intent is to filter out keys such as SPACE, UP, DOWN, etc.
     * that a keyboard user might initially use in place of scrolling
     */
    let shouldRecordKey = true

    if (e.metaKey || e.ctrlKey || e.altKey) {
      shouldRecordKey = false
    }

    for (let key in blacklist) {
      if (code === blacklist[key]) {
        shouldRecordKey = false
      }
    }

    if (shouldRecordKey) {
      // track the first keycode
      this.track({
        category : &apos;First Input&apos;,
        action   : &apos;First Keycode&apos;,
        label    : code
      })

      // also attempt to track this as the first input
      this.recordFirstInput(&apos;keyboard&apos;, code)
    }
  }

  /**
   * Tracks the first input used. Does nothing after the first call.
   *
   * @param { String } inputType - The type of interaction (&apos;click&apos;, &apos;touchstart&apos;, etc.)
   * @param { String } keyCode   - The code describing which key was pressed
   */
  recordFirstInput(inputType, keyCode) {
    if (!this.firstInputRecorded) {
      this.track({
        category : &apos;First Input&apos;,
        action   : inputType,
        label    : keyCode
      })

      this.firstInputRecorded = true
    }
  }
}

export default FirstInputPlugin
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.3.1)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
